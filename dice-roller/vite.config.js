import { defineConfig } from "vite";

// Plugin to serve dynamic dice SVGs
function dynamicDicePlugin() {
  const wireframes = {
    d4: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><g transform="matrix(4.05761,0,0,4.05761,-3397.86,-4912.41)">
      <path d="M917.833,1642.22L899.298,1490.73C899.298,1490.73 895.78,1450.61 915.12,1437.07C934.46,1423.53 957.598,1416.28 976.819,1409C989.785,1404.09 1091.06,1346.13 1073.49,1425.29C1070.16,1440.29 1057.49,1510.47 1040.35,1579.21C1007.27,1711.86 961.467,1874.72 961.467,1874.72C961.467,1874.72 948.09,1905.36 942.682,1847.5C935.509,1770.76 917.833,1642.22 917.833,1642.22Z" stroke="#bbbbbb" stroke-width="15" fill="none"/>
    </g>
    <g transform="matrix(4.05761,0,0,4.05761,-3397.86,-4912.41)">
      <path d="M1007.89,1736.3C1007.27,1736.24 1063.2,1533.5 1078.28,1480.38C1081.66,1468.5 1092.27,1429.9 1098.2,1418.91C1105.37,1405.64 1107.22,1382.73 1134.61,1402.86C1187.36,1441.64 1289.69,1526.73 1289.69,1526.73C1289.69,1526.73 1349.03,1573.85 1384.02,1608.12C1398.96,1622.75 1395.65,1641.08 1361.78,1666.77C1304.9,1709.9 1016.03,1891.35 1016.03,1891.35C1016.03,1891.35 971.586,1919.01 983.033,1853.41C998.058,1767.31 1008.51,1736.36 1007.89,1736.3Z" stroke="#bbbbbb" stroke-width="15" fill="none"/>
    </g>
    <path d="M326.342,1751.06L251.135,1136.4C251.135,1136.4 236.861,973.596 315.335,918.647C393.81,863.698 487.693,834.275 565.686,804.757C618.296,784.845 1029.22,549.656 957.943,870.866C944.445,931.7 893.005,1216.47 823.455,1495.39C689.243,2033.63 503.393,2694.45 503.393,2694.45C503.393,2694.45 449.117,2818.78 427.171,2584C398.065,2272.64 326.342,1751.06 326.342,1751.06ZM691.778,2132.81C689.263,2132.55 916.171,1309.95 977.392,1094.37C991.072,1046.19 1034.14,889.555 1058.2,844.989C1087.27,791.135 1094.8,698.165 1205.92,779.852C1419.96,937.19 1835.21,1282.45 1835.21,1282.45C1835.21,1282.45 2075.96,1473.65 2217.94,1612.72C2278.55,1672.07 2265.13,1746.45 2127.69,1850.67C1896.9,2025.67 724.777,2761.96 724.777,2761.96C724.777,2761.96 544.454,2874.16 590.899,2608C651.865,2258.62 694.293,2133.06 691.778,2132.81Z" stroke="#888888" stroke-width="60" fill="none"/></g>`,

    d6: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><path d="M353.181,2223.36L269.416,1711.92C269.416,1711.92 231.75,1535.93 428.223,1571.58C624.696,1607.23 1590.23,1861.72 1590.23,1861.72C1590.23,1861.72 1813.32,1891.35 1811.53,2143.82C1809.73,2396.3 1813.55,2766.85 1792.49,2819.38C1776.26,2859.9 1741.85,2952.91 1610.8,2914.19C1479.76,2875.47 581.285,2632.09 581.285,2632.09C581.285,2632.09 431.152,2588.25 397.369,2462.15C363.587,2336.04 353.181,2223.36 353.181,2223.36ZM1851.11,2668.22C1851.6,2651.63 1875.5,1974.64 1875.5,1974.64C1875.5,1974.64 1893.14,1848.43 1986.29,1633.14C2079.45,1417.85 2188.93,1130.5 2188.93,1130.5C2188.93,1130.5 2269.5,908.29 2230.43,1269.24C2191.35,1630.18 2205.3,1630.98 2182.82,1831.11C2165.7,1983.47 2136.92,2090.69 2087.63,2240.32C2058.54,2328.64 1965.71,2573.96 1939.41,2636.19C1927.23,2665.04 1843.61,2918.6 1851.11,2668.22ZM404.249,1266.97L768.321,722.431C768.321,722.431 840.597,582.793 1048.27,625.875C1255.95,668.957 1868.98,783.713 1868.98,783.713C1868.98,783.713 2278.91,795.292 2163.4,1056.36C2047.89,1317.43 1904.44,1654.8 1904.44,1654.8C1904.44,1654.8 1836.4,1850.22 1566.26,1781.81C1296.12,1713.39 607.244,1571.2 607.244,1571.2C607.244,1571.2 423.866,1532.89 402.334,1519.85C380.803,1506.8 267.013,1451.79 404.249,1266.97Z" stroke="#888888" stroke-width="60" fill="none"/></g>`,

    d8: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><path d="M384.098,1613.26L614.276,856.714C614.276,856.714 671.534,798.025 646.852,1007.92C622.17,1217.81 587.729,1546.12 587.729,1546.12L541.405,1780.38C541.405,1780.38 539.627,1916.78 427.688,1998.84C315.75,2080.91 233.971,2139.8 275.889,1990.54C317.807,1841.27 384.098,1613.26 384.098,1613.26ZM616.91,1745.63L668.152,1095.37C668.152,1095.37 682.371,781.749 688.298,738.144C693.159,702.371 715.273,566.798 862.604,621.109C897.803,634.084 946.451,656.932 999.565,684.163C1117.69,744.723 1466.51,907.601 1466.51,907.601L2100.82,1211.26C2100.82,1211.26 2154.35,1242.23 1969.21,1325.4C1733.57,1431.25 1216.07,1646.27 1216.07,1646.27L725.872,1856.92C725.872,1856.92 594.511,1927.61 616.91,1745.63ZM1178.27,2665.72L365.823,2225.15C365.823,2225.15 250.816,2144.69 363.109,2093.3C475.401,2041.9 532.98,2025.58 627.191,2097.76C721.403,2169.93 1409.67,2751.37 1409.67,2751.37C1409.67,2751.37 1506.39,2845.47 1353.56,2759.11C1200.73,2672.76 1178.27,2665.72 1178.27,2665.72ZM883.913,2269.65L696.412,2055.9C696.412,2055.9 630.589,1969.64 776.957,1890.81C1028,1755.59 1319.47,1630.19 1319.47,1630.19L1682.09,1484.95L2072.03,1348.35C2072.03,1348.35 2206.19,1287.44 2136.29,1488.63C2066.39,1689.83 1725.45,2783.54 1725.45,2783.54C1725.45,2783.54 1691.58,2908.53 1540.33,2807.28C1341.91,2674.47 883.913,2269.65 883.913,2269.65Z" stroke="#888888" stroke-width="60" fill="none"/></g>`,

    d10: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><path d="M851.58,1727.43C851.58,1727.43 985.784,1007.67 1045.7,860.92C1066.61,809.705 1098.93,766.259 1143.51,799.015C1308.79,920.459 2037.38,1589.58 2037.38,1589.58C2037.38,1589.58 2086.11,1629.64 2031.7,1688.47C1977.3,1747.31 1616.24,2035.02 1616.24,2035.02C1616.24,2035.02 1554.5,2088.38 1448.23,2084.67C1341.96,2080.96 972.502,2040.3 972.502,2040.3C972.502,2040.3 792.676,2019.36 816.466,1899.32C840.257,1779.28 851.58,1727.43 851.58,1727.43ZM1532.35,2490.89C1532.35,2490.89 1559.16,2260.5 1575.33,2215.15C1591.5,2169.8 1600.72,2133.6 1670.36,2067.44C1740,2001.28 1948.73,1821.34 1948.73,1821.34C1948.73,1821.34 2082.74,1691.46 2141.63,1674.51C2200.52,1657.56 2316.82,1632.33 2263.68,1701.67C2210.53,1771.02 1560.07,2616.22 1560.07,2616.22C1560.07,2616.22 1489.89,2695.18 1532.35,2490.89ZM287.904,1971.15C278.368,1945.74 266.854,1915.87 263.581,1889.37C258.653,1849.46 250.314,1811.08 313.386,1731.22C376.457,1651.36 583.899,1370.38 583.899,1370.38L961.024,858.798C961.024,858.798 1048.84,712.959 994.648,923.859C940.454,1134.76 809.073,1732.47 809.073,1732.47C809.073,1732.47 731.624,1997.76 620.393,2060.35C509.162,2122.94 469.876,2144.59 423.553,2153.07C393.631,2158.54 363.734,2151.18 342.453,2111.23C321.172,2071.28 301.646,2007.78 287.904,1971.15ZM1966.32,1461.35L1275.94,856.001C1275.94,856.001 1196.5,777.739 1349.14,870.436C1501.78,963.134 1894.28,1168.67 1894.28,1168.67C1894.28,1168.67 2082.86,1255.24 2159.12,1391.89C2235.38,1528.54 2273.3,1569.33 2273.3,1569.33C2273.3,1569.33 2303.12,1625.1 2230.45,1616.28C2157.77,1607.45 2076.53,1565.11 1966.32,1461.35ZM483.963,2255.18C484.167,2256.25 377.684,2215.37 508.236,2156.79C616.548,2108.19 619.507,2105.11 679.355,2096.12C763.993,2083.41 909.437,2065.2 1016.07,2080.54C1122.7,2095.89 1329.09,2110.97 1410.62,2143.32C1467.55,2165.92 1509.66,2172.73 1508.13,2267.23C1506.6,2361.73 1487.44,2617.65 1487.44,2617.65C1487.44,2617.65 1474.17,2708.63 1375.13,2664.18C1276.09,2619.74 953.396,2476.37 953.396,2476.37C953.396,2476.37 483.759,2254.12 483.963,2255.18Z" stroke="#888888" stroke-width="60" fill="none"/></g>`,

    d12: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><path d="M257.596,1704.47L429.504,1313.2C429.504,1313.2 476.225,1181.75 563.712,1091.92C651.2,1002.08 710.846,957.493 710.846,957.493C710.846,957.493 790.92,870.92 751.561,994.89C712.203,1118.86 697.056,1265.29 672.262,1302.64C648.487,1338.46 548.433,1494.61 465.608,1590.84C382.784,1687.07 294.649,1814.42 294.649,1814.42C294.649,1814.42 217.813,1852.59 257.596,1704.47ZM950.271,2621.77C950.271,2621.77 1221.53,2514.57 1428.97,2497.03C1636.4,2479.49 1778.5,2488.39 1778.5,2488.39C1778.5,2488.39 2010.8,2475.01 1838.07,2574.7C1665.33,2674.39 1614.85,2704.8 1562.17,2713.74C1509.49,2722.68 1077.66,2744.85 1077.66,2744.85C1077.66,2744.85 947.176,2762.36 884.83,2698.62C844.98,2659.89 841.008,2654.74 950.271,2621.77ZM785.387,1050.17C811.882,954.303 820.923,845.643 1027.84,819.327C1282.5,786.939 1402.16,787.606 1402.16,787.606C1402.16,787.606 1593.72,737.908 1704.13,898.42C1752.48,968.714 1821.61,1040.85 1864.14,1098.19C1878.61,1117.7 1960.87,1173.99 1836.16,1273.04C1736.27,1352.38 1664.59,1431.25 1567.89,1474.22C1464.26,1520.28 1408.15,1561.49 1187.36,1478.12C966.566,1394.75 852.028,1367.55 823.322,1352.28C797.452,1338.51 743.737,1348.79 752.996,1226.43C760.626,1125.59 754.464,1162.05 785.387,1050.17ZM1059.25,1503.09L1289.03,1580.14C1289.03,1580.14 1426.68,1622 1425.75,1799.99C1424.82,1977.98 1430.9,2274.81 1430.9,2274.81C1430.9,2274.81 1423.58,2428.32 1224.86,2481.15C1026.15,2533.99 901.957,2602.6 868.34,2602.09C813.884,2601.25 758.306,2567.66 724.153,2525.24C692.907,2486.43 334.89,1998.76 334.89,1998.76C334.89,1998.76 269.93,1908.34 334.2,1838.66C395.693,1756.43 596.327,1510.7 596.327,1510.7C596.327,1510.7 680.292,1364.92 845.271,1427.52C1010.25,1490.11 1059.25,1503.09 1059.25,1503.09ZM1485.03,2103.5L1481.41,1795.94C1481.41,1795.94 1450.99,1629.57 1630.35,1502.01C1717.67,1439.92 1827.06,1320.33 1897.38,1294.99C1990.23,1261.51 2018.89,1335.73 2061.9,1380.01C2116.63,1436.34 2225.77,1632.98 2225.77,1632.98C2225.77,1632.98 2314.75,1774.21 2227.25,1968.62C2154.7,2129.85 2073.13,2317.81 2048.73,2369.36C1991.26,2490.81 1938.92,2458.78 1751.69,2444.61C1657.64,2437.49 1514.07,2422.99 1487.37,2297.95C1482.66,2175.91 1485.03,2103.5 1485.03,2103.5Z" stroke="#888888" stroke-width="60" fill="none"/></g>`,

    d20: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><g transform="matrix(5.02505,0,0,5.02505,-3979.16,-3556.73)">
      <path d="M911.482,890.456L999.559,834.927C999.559,834.927 1020.68,822.794 1009.42,841.692C998.159,860.591 956.204,926.822 956.204,926.822L929.726,964.909C929.726,964.909 926.718,972.917 912.93,968.074C899.142,963.23 869.208,945.349 869.208,945.349C869.208,945.349 855.627,935.373 866.97,923.34C878.312,911.307 911.482,890.456 911.482,890.456ZM849.739,1052.37L845.21,969.387C845.21,969.387 847.024,942.245 868.253,953.945C889.482,965.645 904.893,980.23 908.023,984.325C909.655,986.46 911.115,989.551 911.779,994.011C912.639,999.783 908.69,1012.82 905.878,1019.12C896.727,1039.61 868.813,1108.93 868.813,1108.93L862.761,1121.05C862.761,1121.05 853.94,1142.86 851.514,1107.93C849.81,1083.4 849.739,1052.37 849.739,1052.37ZM882.56,1096.14L916.149,1020.93C916.149,1020.93 929.697,1002.13 941.858,1022.72C955.056,1041.76 1043.64,1175.98 1043.64,1175.98C1043.64,1175.98 1049.22,1189.49 1033.34,1187.29C1017.47,1185.1 885.516,1157.79 885.516,1157.79C885.516,1157.79 868.005,1155.84 865.881,1142.69C865.433,1139.91 866.95,1130.64 870.568,1123.24C874.186,1115.84 882.56,1096.14 882.56,1096.14ZM962.859,935.435L1016.38,846.416C1016.38,846.416 1022.61,832.879 1031.46,829.914C1040.31,826.948 1049.34,828.352 1061.67,840.2C1074,852.048 1123.79,903.792 1123.79,903.792L1153.87,934.393C1153.87,934.393 1176.42,953.724 1150.75,956.784C1125.09,959.843 1077.24,964.18 1077.24,964.18L975.61,975.092L963.232,975.627C963.232,975.627 947.458,977.841 944.894,971.501C942.329,965.162 948.01,956.865 951.265,951.629C954.52,946.392 962.859,935.435 962.859,935.435ZM953.481,1018.88C953.481,1018.88 941.911,999.378 953.532,992.408C954.63,991.75 956.493,988.721 974.815,986.454C994.517,984.017 1039.48,979.609 1039.48,979.609L1127.17,969.388L1153.33,967.963C1153.33,967.963 1173.79,965.645 1168.8,978.831C1163.8,992.016 1080.75,1154.72 1080.75,1154.72L1069.51,1172.5C1069.51,1172.5 1060.06,1184.39 1049.62,1166.44C1039.19,1148.49 953.481,1018.88 953.481,1018.88ZM1111.11,1200.95L1067.58,1225.2C1067.58,1225.2 1052.13,1230.99 1055.16,1218.62C1055.99,1215.28 1058.05,1209.15 1059.99,1207.01C1067.32,1198.91 1075.16,1199.53 1087.44,1194.14C1102.97,1187.33 1131.17,1176.55 1131.17,1176.55L1186.65,1157.05C1186.65,1157.05 1187.33,1157.65 1175.55,1165.38C1163.78,1173.11 1111.11,1200.95 1111.11,1200.95ZM996.717,1223.25C973.988,1214.57 924.923,1186.49 899.606,1175.36C874.29,1164.22 894.773,1166.49 894.773,1166.49L913.491,1169.62L1005.16,1189.72C1005.16,1189.72 1029.31,1196.04 1040.1,1201.54C1041.38,1202.19 1046.42,1205.06 1047.38,1210.29C1048.63,1217.09 1045.32,1226.81 1041.74,1229.99C1039.67,1231.84 1035.24,1231.46 1028.52,1231.06C1020.82,1230.6 1009.9,1228.28 996.717,1223.25ZM1093.84,1147.37L1178.24,981.304C1178.24,981.304 1183.76,968.848 1190.92,999.498C1199.31,1029.07 1212.84,1076.76 1212.84,1076.76L1220.53,1105.12C1220.53,1105.12 1228.62,1132.45 1200.33,1144.45C1175.7,1152.85 1087.78,1183.84 1087.78,1183.84C1087.78,1183.84 1072.99,1190.23 1079.46,1174.32C1085.92,1158.4 1093.84,1147.37 1093.84,1147.37ZM1192.49,972.857C1192.49,972.857 1190.89,957.749 1192.59,953.583C1193.9,950.356 1193.72,949.501 1197.33,944.429C1199.12,941.918 1200.84,939.933 1202.5,938.666C1206.73,935.429 1210.53,936.869 1213.84,946.158C1218.46,959.084 1221.02,1022.91 1221.02,1022.91L1226.18,1084.14C1226.18,1084.14 1223.02,1089.39 1219.15,1072.79C1215.29,1056.18 1192.49,972.857 1192.49,972.857ZM1168.98,939.26L1115.37,883.446C1115.37,883.446 1095.11,863.57 1074.16,842.798C1053.21,822.027 1078.18,836.575 1078.18,836.575C1078.18,836.575 1141.27,872.67 1172,889.077C1202.73,905.484 1197.13,916.034 1197.99,922.096C1198.85,928.158 1194.82,934.346 1188.21,940.962C1181.61,947.578 1168.98,939.26 1168.98,939.26Z" stroke="#888888" stroke-width="12" fill="none"/>
    </g></g>`,

    d100: `<g transform="translate(1240.5, 1754) scale(1.1) translate(-1240.5, -1754)"><path d="M851.58,1727.43C851.58,1727.43 985.784,1007.67 1045.7,860.92C1066.61,809.705 1098.93,766.259 1143.51,799.015C1308.79,920.459 2037.38,1589.58 2037.38,1589.58C2037.38,1589.58 2086.11,1629.64 2031.7,1688.47C1977.3,1747.31 1616.24,2035.02 1616.24,2035.02C1616.24,2035.02 1554.5,2088.38 1448.23,2084.67C1341.96,2080.96 972.502,2040.3 972.502,2040.3C972.502,2040.3 792.676,2019.36 816.466,1899.32C840.257,1779.28 851.58,1727.43 851.58,1727.43ZM1532.35,2490.89C1532.35,2490.89 1559.16,2260.5 1575.33,2215.15C1591.5,2169.8 1600.72,2133.6 1670.36,2067.44C1740,2001.28 1948.73,1821.34 1948.73,1821.34C1948.73,1821.34 2082.74,1691.46 2141.63,1674.51C2200.52,1657.56 2316.82,1632.33 2263.68,1701.67C2210.53,1771.02 1560.07,2616.22 1560.07,2616.22C1560.07,2616.22 1489.89,2695.18 1532.35,2490.89ZM287.904,1971.15C278.368,1945.74 266.854,1915.87 263.581,1889.37C258.653,1849.46 250.314,1811.08 313.386,1731.22C376.457,1651.36 583.899,1370.38 583.899,1370.38L961.024,858.798C961.024,858.798 1048.84,712.959 994.648,923.859C940.454,1134.76 809.073,1732.47 809.073,1732.47C809.073,1732.47 731.624,1997.76 620.393,2060.35C509.162,2122.94 469.876,2144.59 423.553,2153.07C393.631,2158.54 363.734,2151.18 342.453,2111.23C321.172,2071.28 301.646,2007.78 287.904,1971.15ZM1966.32,1461.35L1275.94,856.001C1275.94,856.001 1196.5,777.739 1349.14,870.436C1501.78,963.134 1894.28,1168.67 1894.28,1168.67C1894.28,1168.67 2082.86,1255.24 2159.12,1391.89C2235.38,1528.54 2273.3,1569.33 2273.3,1569.33C2273.3,1569.33 2303.12,1625.1 2230.45,1616.28C2157.77,1607.45 2076.53,1565.11 1966.32,1461.35ZM483.963,2255.18C484.167,2256.25 377.684,2215.37 508.236,2156.79C616.548,2108.19 619.507,2105.11 679.355,2096.12C763.993,2083.41 909.437,2065.2 1016.07,2080.54C1122.7,2095.89 1329.09,2110.97 1410.62,2143.32C1467.55,2165.92 1509.66,2172.73 1508.13,2267.23C1506.6,2361.73 1487.44,2617.65 1487.44,2617.65C1487.44,2617.65 1474.17,2708.63 1375.13,2664.18C1276.09,2619.74 953.396,2476.37 953.396,2476.37C953.396,2476.37 483.759,2254.12 483.963,2255.18Z" stroke="#888888" stroke-width="60" fill="none"/></g>`
  };

  return {
    name: 'dynamic-dice',
    configureServer(server) {
      server.middlewares.use((req, res, next) => {
        const match = req.url?.match(/^\/dice\/(d\d+)\?/);
        if (match) {
          const diceType = match[1];
          const url = new URL(req.url, 'http://localhost');
          const value = url.searchParams.get('value') || '1';
          const color = url.searchParams.get('color') || '#888888';

          const wireframe = wireframes[diceType];
          if (!wireframe) {
            next();
            return;
          }

          const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 2481 3508">
  <rect x="-393.5" y="120" width="3268" height="3268" rx="1200" ry="1200" fill="black"/>
  <rect x="-393.5" y="120" width="3268" height="3268" rx="1200" ry="1200" fill="none" stroke="${color}" stroke-width="100"/>
  ${wireframe}
  <text x="1240.5" y="1754" font-family="Arial, sans-serif" font-size="2000" font-weight="bold" fill="#ffffff" text-anchor="middle" dominant-baseline="middle">${value}</text>
</svg>`;

          res.setHeader('Content-Type', 'image/svg+xml');
          res.setHeader('Access-Control-Allow-Origin', 'https://www.owlbear.rodeo');
          res.end(svg);
        } else {
          next();
        }
      });
    },
  };
}

export default defineConfig({
  plugins: [dynamicDicePlugin()],
  server: {
    cors: {
      origin: "https://www.owlbear.rodeo",
    },
  },
});
